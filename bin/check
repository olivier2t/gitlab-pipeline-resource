#!/bin/bash

set -e

exec 5>&1 # make stdout available as fd 5 for the result
exec 1>&2 # redirect all output to stderr for logging

main() {
  echo "\n\n--[CHECK]-------------------------"
  extractVersion
  emitResult
}

extractVersion() {
  echo "\n--> extracting requested version..."
  jq -r '.' < $payload
  requestedVersion=$(jq -r '.version' < $payload)
  echo "requested version: $requestedVersion"
  exit 1
}

emitResult() {
  jq  --arg pipeline_id "$requestedVersion" \
      -n '[
        { "id": "${pipeline_id}" }
      ]' >&5
}

if [ "${BASH_SOURCE[0]}" == "${0}" ]; then
  source $(dirname $0)/common
  main "$@"
fi
